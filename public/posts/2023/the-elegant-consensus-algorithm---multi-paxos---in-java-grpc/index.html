<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>The elegant consensus algorithm - Multi-Paxos - in Java gRPC | iHelio</title>
<meta name=keywords content="Distributed System,Algorithms,gRPC"><meta name=description content="Introduction Paxos is a distributed consensus algorithm developed by Lamport. It is proved optimal and many systems are built based on it like chubby and zookeeper.
But this article is not going to discuss Lamport&rsquo;s orginal paper but focus on the engineering implementations. My colleague highly recommended Ongaro&rsquo;s lecture of Paxos and said it is the best source of learning Paxos. I cannot agree more after studying it. That being said, I will briefly talk about Paxos and Multi-Paxos and dive into the engineering implementations."><meta name=author content="Me"><link rel=canonical href=ihelio.today/posts/2023/the-elegant-consensus-algorithm---multi-paxos---in-java-grpc/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=ihelio.today/assets/css/stylesheet.d6fcd20a4fb86efa4dfac8ec95da60244cc8871042183da1ef28e3a762ad79c8.css integrity="sha256-1vzSCk+4bvpN+sjsldpgJEzIhxBCGD2h7yjjp2Ktecg=" rel="preload stylesheet" as=style><link rel=icon href=ihelio.today/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=ihelio.today/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=ihelio.today/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=ihelio.today/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=ihelio.today/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=ihelio.today/posts/2023/the-elegant-consensus-algorithm---multi-paxos---in-java-grpc/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-R4SSGN5Y2Z"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-R4SSGN5Y2Z")}</script><meta property="og:url" content="ihelio.today/posts/2023/the-elegant-consensus-algorithm---multi-paxos---in-java-grpc/"><meta property="og:site_name" content="iHelio"><meta property="og:title" content="The elegant consensus algorithm - Multi-Paxos - in Java gRPC"><meta property="og:description" content="Introduction Paxos is a distributed consensus algorithm developed by Lamport. It is proved optimal and many systems are built based on it like chubby and zookeeper.
But this article is not going to discuss Lamport’s orginal paper but focus on the engineering implementations. My colleague highly recommended Ongaro’s lecture of Paxos and said it is the best source of learning Paxos. I cannot agree more after studying it. That being said, I will briefly talk about Paxos and Multi-Paxos and dive into the engineering implementations."><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-09-16T16:17:15-04:00"><meta property="article:modified_time" content="2023-09-16T16:17:15-04:00"><meta property="article:tag" content="Distributed System"><meta property="article:tag" content="Algorithms"><meta property="article:tag" content="GRPC"><meta property="og:image" content="ihelio.today/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="ihelio.today/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="The elegant consensus algorithm - Multi-Paxos - in Java gRPC"><meta name=twitter:description content="Introduction Paxos is a distributed consensus algorithm developed by Lamport. It is proved optimal and many systems are built based on it like chubby and zookeeper.
But this article is not going to discuss Lamport&rsquo;s orginal paper but focus on the engineering implementations. My colleague highly recommended Ongaro&rsquo;s lecture of Paxos and said it is the best source of learning Paxos. I cannot agree more after studying it. That being said, I will briefly talk about Paxos and Multi-Paxos and dive into the engineering implementations."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"ihelio.today/posts/"},{"@type":"ListItem","position":2,"name":"The elegant consensus algorithm - Multi-Paxos - in Java gRPC","item":"ihelio.today/posts/2023/the-elegant-consensus-algorithm---multi-paxos---in-java-grpc/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"The elegant consensus algorithm - Multi-Paxos - in Java gRPC","name":"The elegant consensus algorithm - Multi-Paxos - in Java gRPC","description":"Introduction Paxos is a distributed consensus algorithm developed by Lamport. It is proved optimal and many systems are built based on it like chubby and zookeeper.\nBut this article is not going to discuss Lamport\u0026rsquo;s orginal paper but focus on the engineering implementations. My colleague highly recommended Ongaro\u0026rsquo;s lecture of Paxos and said it is the best source of learning Paxos. I cannot agree more after studying it. That being said, I will briefly talk about Paxos and Multi-Paxos and dive into the engineering implementations.","keywords":["Distributed System","Algorithms","gRPC"],"articleBody":"Introduction Paxos is a distributed consensus algorithm developed by Lamport. It is proved optimal and many systems are built based on it like chubby and zookeeper.\nBut this article is not going to discuss Lamport’s orginal paper but focus on the engineering implementations. My colleague highly recommended Ongaro’s lecture of Paxos and said it is the best source of learning Paxos. I cannot agree more after studying it. That being said, I will briefly talk about Paxos and Multi-Paxos and dive into the engineering implementations.\nMulti-Paxos \u0026 Paxos In short, Multi-Paxos is simply the multiple use of Paxos. Paxos is developed by Lamport in 1998 for the distributed consensus problem. There are three agents: proposer, acceptor and listener in Paxos. They can be the same server or separate server depending on the design. In Ongaro’s lecture, the listener is part of acceptor thus it ends up with two agents proposer and acceptor (In Lamport’s Paxos Made Simple, a server could be proposer, acceptor and lisenter at the same time). To chose an value, proposer is using a 2-phase protocal to lock down an entry in the acceptors’ logs.\nWith Paxos, we can meet the requirements of safety and liveness:\nSafety: Nothing bad is going to happen - at least one value is chosen Liveness: Eventually a good thing is going to happen - one value is going to be chosen eventually To avoid livelock, we could use exponential backoff or leader election in Muliti-Paxos Only proposer knows which value has been chosen, other proposers must execute Paxos with their own proposal to get the chosen value As said in the beginning, Multi-Paxos is the multiple use of Paxos which means we will use Paxos to choose a value for a log entry every time the client make request. Thus Dr. Ongaro pointed out several issues of Multi-Paxos and suggested solutions:\nWhich log entry to use for a given client request? When jmp command is sent to the server s1, s1 need to track the variable firstUnchosenIndex If the firstUnchosenIndex already has a value, s1 will send the proposal using the existing value and increment firstUnchosenIndex once the value is chosen Then s1 will start from the beginning until the firstUnchosenIndex has no value then s1 makes proposal from jmp command The server could handle the client requests concurrently Suppose we have multiple requests We can try each unchosen index for one independent request So we would need a collection of UnchosenIndex Then the application of log entry should be sequential in the state trasaction machine. Paxos is slow because of 2-phase protocal and could have intense competition with several proposers (livelock) We should use leader-election to ensure a single Proposer at any given time Bully algorithm - the server with the largest ID is the leader Each server sends the heartbeat to other servers every T ms If a server hasn’t recevied the heartbeat from server with higher ID in last 2T ms, it is a leader Accept requests from clients Acts as proposer and acceptor The rest servers are followers Redirected request to leader Acts as acceptor We could send proposal msg to the entire log thus all the log entries would have a global proposal number which can block all old proposals Then we should collect highestProposal accepcted for current entry and noMoreAccepted bool from the propose request noMoreAccepted: no more accepcted values after the current entry If the leader recevies noMoreAccepted from the majority acceptors, the leader doesn’t have to send any prepare requests and only need accept requests How to ensure the full replication across servers? Left issues: Log entries not fully replicated Only proposer knows when entry is chosen Solutions: Keep send accept request until all acceptors respond mark entires chosen infinite to prevent overwritten each server should track firstUnchosenIndex proposer include firstUnchosenIndex in its accept requests acceptor should mark all entries chosen if the entires are lower than firstUnchosenIndex and the entries have the same proposal number acceptor could consult with the leader about unknown index acceptor includes its firstUnchosenIndex in accept replies if proposer’s fristUnchosenIndex is larger then it sends the success request to acceptor to confirm the chosen status and acceptor keep returning the firstUnchosenIndex till it catches up How to deal with fail-stop issues from client perspective? The client could submit the same request multiple times thus we need idempotent key associated with each request How to update the configuration of servers? Configuration change impacts the number of servers determines majority quorum size $\\alpha$ parameter save the configuration as normal log entries configuration is treated like any other CURD commands save the configuration at the entry i then all the entry i + $\\alpha$ will use the configuration at entry i if there is configuration file/command e.g. if we updated the configuration, the configuration file will be stored at index $i$ based on paxos and everytime the leader should check the position $i$ to see if there is a configuration file if yes, the configuration should be updated otherwise, the existing configuration should be used if $\\alpha$ is too small, the system wind up as a synchronous system if $\\alpha$ is too large, the update of configuration could take a while we could use no-op command to quickly update the log entires between $i$ and $i+\\alpha$ so configuration could update Engineering Impl This section will summaries the details of the RPC between proposer and acceptors.\nServer Each server has its own logs to maintain and we need make sure the logs are consistent across all servers Leader election: only leader acts as Proposer to replicate the log entries State log value proposal mark the entries known to be chosen each server maintains firstUnchosenIndex Message proposer -\u003e acceptor - prepare msg - global proposal number - index - value - accept msg - for acceptor sent noMoreAccepted, only need send accept msg - once the majority acceptor sent noMoreAccepted, only need send accept msg - keep retrying until all acceptors respond - {proposal: p; index: i; value: v; firstUnchosenIndex: u_i;} - mark all entries before firstUnchoseIndex equal to proposal as chosen - put the proposal and value at index i of log acceptor -\u003e proposer response msg noMoreAccepted firstUnchosenIndex proposer will compare its firstUnchosenIndex with accpetor’s firstUnchosenIndex if \u003e: the propser will send Success msg to acceptor to confirm the entry is took {index: i; value: v} then acceptor will updated acceptedValue[i] and acceptedProposal[i] and return another response contains the updated firstUnchosenIndex Client Any possible command like CRUD operations on database.\ngRPC Service Proposer Prepare Msg Proposal Accept Msg Proposal Index Value FirstUnchosenIndex Success Msg Index Value Acceptor Response Msg FirstUnchosenIndex noMoreUnaccepted Client Command like CRUD The code can be found at [here](ydeng11/Multi-Paxos (github.com)).\n","wordCount":"1122","inLanguage":"en","image":"ihelio.today/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2023-09-16T16:17:15-04:00","dateModified":"2023-09-16T16:17:15-04:00","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"ihelio.today/posts/2023/the-elegant-consensus-algorithm---multi-paxos---in-java-grpc/"},"publisher":{"@type":"Organization","name":"iHelio","logo":{"@type":"ImageObject","url":"ihelio.today/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=ihelio.today/ accesskey=h title="Home (Alt + H)"><img src=/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=ihelio.today/ihelio.today/archives/ title=Archive><span>Archive</span></a></li><li><a href=ihelio.today/ihelio.today/categories/ title=Categories><span>Categories</span></a></li><li><a href=ihelio.today/search/ title=Search><span>Search</span></a></li><li><a href=ihelio.today/ihelio.today/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=ihelio.today/>Home</a>&nbsp;»&nbsp;<a href=ihelio.today/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">The elegant consensus algorithm - Multi-Paxos - in Java gRPC</h1><div class=post-meta><span title='2023-09-16 16:17:15 -0400 EDT'>September 16, 2023</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;1122 words&nbsp;·&nbsp;Me&nbsp;|&nbsp;<a href=https://github.com/ydeng11/ihelio/tree/main/content/posts/2023/The%20elegant%20consensus%20algorithm%20-%20Multi-Paxos%20-%20in%20Java%20gRPC.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=post-content><h2 id=introduction>Introduction<a hidden class=anchor aria-hidden=true href=#introduction>#</a></h2><p>Paxos is a distributed consensus algorithm developed by Lamport. It is proved optimal and many systems are built based on it like chubby and zookeeper.</p><p>But this article is not going to discuss Lamport&rsquo;s orginal paper but focus on the engineering implementations. My colleague highly recommended Ongaro&rsquo;s lecture of Paxos and said it is the best source of learning Paxos. I cannot agree more after studying it. That being said, I will briefly talk about Paxos and Multi-Paxos and dive into the engineering implementations.</p><h2 id=multi-paxos--paxos>Multi-Paxos & Paxos<a hidden class=anchor aria-hidden=true href=#multi-paxos--paxos>#</a></h2><p>In short, Multi-Paxos is simply the multiple use of Paxos. Paxos is developed by Lamport in 1998 for the distributed consensus problem. There are three agents: proposer, acceptor and listener in Paxos. They can be the same server or separate server depending on the design. In Ongaro&rsquo;s lecture, the listener is part of acceptor thus it ends up with two agents proposer and acceptor (In Lamport&rsquo;s Paxos Made Simple, a server could be proposer, acceptor and lisenter at the same time). To chose an value, proposer is using a 2-phase protocal to lock down an entry in the acceptors&rsquo; logs.</p><p><img loading=lazy src=https://i.imgur.com/Tpn7vlY.png></p><p>With Paxos, we can meet the requirements of safety and liveness:</p><ul><li>Safety: Nothing bad is going to happen - at least one value is chosen</li><li>Liveness: Eventually a good thing is going to happen - one value is going to be chosen eventually<ul><li>To avoid livelock, we could use exponential backoff or leader election in Muliti-Paxos</li></ul></li></ul><pre tabindex=0><code class=language-ad-note data-lang=ad-note>Only proposer knows which value has been chosen, other proposers must execute Paxos with their own proposal to get the chosen value 
</code></pre><p>As said in the beginning, Multi-Paxos is the multiple use of Paxos which means we will use Paxos to choose a value for a log entry every time the client make request. Thus Dr. Ongaro pointed out several issues of Multi-Paxos and suggested solutions:</p><ul><li>Which log entry to use for a given client request?<ul><li><img loading=lazy src=https://i.imgur.com/Sfh9ZY8.png></li><li>When <code>jmp</code> command is sent to the server <code>s1</code>, <code>s1</code> need to track the variable <code>firstUnchosenIndex</code></li><li>If the <code>firstUnchosenIndex</code> already has a value, <code>s1</code> will send the proposal using the existing value and increment <code>firstUnchosenIndex</code> once the value is chosen</li><li>Then <code>s1</code> will start from the beginning until the <code>firstUnchosenIndex</code> has no value then <code>s1</code> makes proposal from <code>jmp</code> command</li><li>The server could handle the client requests concurrently<ul><li>Suppose we have multiple requests</li><li>We can try each unchosen index for one independent request</li><li>So we would need a collection of <code>UnchosenIndex</code></li></ul></li><li>Then the application of log entry should be sequential in the state trasaction machine.</li></ul></li><li>Paxos is slow because of 2-phase protocal and could have intense competition with several proposers (livelock)<ul><li>We should use leader-election to ensure a single Proposer at any given time<ul><li>Bully algorithm - the server with the largest ID is the leader<ul><li>Each server sends the heartbeat to other servers every <code>T</code> ms</li><li>If a server hasn&rsquo;t recevied the heartbeat from server with higher ID in last <code>2T</code> ms, it is a leader<ul><li>Accept requests from clients</li><li>Acts as proposer and acceptor</li></ul></li><li>The rest servers are followers<ul><li>Redirected request to leader</li><li>Acts as acceptor</li></ul></li></ul></li></ul></li><li>We could send proposal msg to the entire log thus all the log entries would have a global proposal number which can block all old proposals<ul><li>Then we should collect <code>highestProposal</code> accepcted for current entry and <code>noMoreAccepted</code> bool from the propose request<ul><li><code>noMoreAccepted</code>: no more accepcted values after the current entry</li><li>If the leader recevies <code>noMoreAccepted</code> from the majority acceptors, the leader doesn&rsquo;t have to send any prepare requests and only need accept requests</li></ul></li></ul></li></ul></li><li>How to ensure the full replication across servers?<ul><li>Left issues:<ul><li>Log entries not fully replicated</li><li>Only proposer knows when entry is chosen</li></ul></li><li>Solutions:<ul><li>Keep send accept request until all acceptors respond</li><li>mark entires chosen infinite to prevent overwritten</li><li>each server should track <code>firstUnchosenIndex</code><ul><li>proposer include <code>firstUnchosenIndex</code> in its accept requests</li><li>acceptor should mark all entries chosen if<ul><li>the entires are lower than <code>firstUnchosenIndex</code></li><li>and the entries have the same proposal number</li></ul></li></ul></li><li>acceptor could consult with the leader about unknown index<ul><li>acceptor includes its <code>firstUnchosenIndex</code> in accept replies</li><li>if proposer&rsquo;s <code>fristUnchosenIndex</code> is larger then it sends the success request to acceptor to confirm the chosen status<ul><li>and acceptor keep returning the <code>firstUnchosenIndex</code> till it catches up</li></ul></li></ul></li></ul></li></ul></li><li>How to deal with fail-stop issues from client perspective?<ul><li>The client could submit the same request multiple times thus we need idempotent key associated with each request</li></ul></li><li>How to update the configuration of servers?<ul><li>Configuration change</li><li>impacts<ul><li>the number of servers determines <code>majority</code></li><li>quorum size</li></ul></li><li>$\alpha$ parameter<ul><li>save the configuration as normal log entries<ul><li>configuration is treated like any other CURD commands</li></ul></li><li>save the configuration at the entry i</li><li>then all the entry i + $\alpha$ will use the configuration at entry i if there is configuration file/command<ul><li>e.g. if we updated the configuration, the configuration file will be stored at index $i$ based on paxos</li><li>and everytime the leader should check the position $i$ to see if there is a configuration file<ul><li>if yes, the configuration should be updated</li><li>otherwise, the existing configuration should be used</li></ul></li></ul></li><li>if $\alpha$ is too small, the system wind up as a synchronous system</li><li>if $\alpha$ is too large, the update of configuration could take a while<ul><li>we could use no-op command to quickly update the log entires between $i$ and $i+\alpha$ so configuration could update</li></ul></li></ul></li></ul></li></ul><h2 id=engineering-impl>Engineering Impl<a hidden class=anchor aria-hidden=true href=#engineering-impl>#</a></h2><p>This section will summaries the details of the RPC between proposer and acceptors.</p><h3 id=server>Server<a hidden class=anchor aria-hidden=true href=#server>#</a></h3><ul><li>Each server has its own logs to maintain and we need make sure the logs are consistent across all servers</li><li>Leader election: only leader acts as Proposer to replicate the log entries</li><li>State<ul><li>log<ul><li>value</li><li>proposal</li></ul></li><li>mark the entries known to be chosen</li><li>each server maintains <code>firstUnchosenIndex</code></li></ul></li><li>Message</li><li>proposer -> acceptor
- prepare msg
- global proposal number
- index
- value
- accept msg
- for acceptor sent <code>noMoreAccepted</code>, only need send accept msg
- once the majority acceptor sent noMoreAccepted, only need send accept msg
- keep retrying until all acceptors respond
- <code>{proposal: p; index: i; value: v; firstUnchosenIndex: u_i;}</code>
- mark all entries before firstUnchoseIndex equal to proposal as chosen
- put the proposal and value at index i of log</li><li>acceptor -> proposer<ul><li>response msg<ul><li><code>noMoreAccepted</code></li><li><code>firstUnchosenIndex</code><ul><li>proposer will compare its <code>firstUnchosenIndex</code> with accpetor&rsquo;s <code>firstUnchosenIndex</code><ul><li>if >: the propser will send Success msg to acceptor to confirm the entry is took<ul><li><code>{index: i; value: v}</code></li><li>then acceptor will updated <code>acceptedValue[i]</code> and <code>acceptedProposal[i]</code></li><li>and return another response contains the updated firstUnchosenIndex</li></ul></li></ul></li></ul></li></ul></li></ul></li></ul><h3 id=client>Client<a hidden class=anchor aria-hidden=true href=#client>#</a></h3><p>Any possible command like CRUD operations on database.</p><h3 id=grpc-service>gRPC Service<a hidden class=anchor aria-hidden=true href=#grpc-service>#</a></h3><ul><li>Proposer<ul><li>Prepare Msg<ul><li>Proposal</li></ul></li><li>Accept Msg<ul><li>Proposal</li><li>Index</li><li>Value</li><li>FirstUnchosenIndex</li></ul></li><li>Success Msg<ul><li>Index</li><li>Value</li></ul></li></ul></li><li>Acceptor<ul><li>Response Msg<ul><li>FirstUnchosenIndex</li><li>noMoreUnaccepted</li></ul></li></ul></li><li>Client<ul><li>Command like CRUD</li></ul></li></ul><p>The code can be found at [here](<a href=https://github.com/ydeng11/Multi-Paxos>ydeng11/Multi-Paxos (github.com)</a>).</p></div><footer class=post-footer><ul class=post-tags><li><a href=ihelio.today/tags/distributed-system/>Distributed System</a></li><li><a href=ihelio.today/tags/algorithms/>Algorithms</a></li><li><a href=ihelio.today/tags/grpc/>GRPC</a></li></ul><nav class=paginav><a class=prev href=ihelio.today/posts/2023/sneak-peek-at-the-asynchronous-java/><span class=title>« Prev</span><br><span>Sneak peek at the asynchronous Java</span>
</a><a class=next href=ihelio.today/posts/2023/why-i-dont-like-wsl/><span class=title>Next »</span><br><span>Why I don't like WSL</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share The elegant consensus algorithm - Multi-Paxos - in Java gRPC on x" href="https://x.com/intent/tweet/?text=The%20elegant%20consensus%20algorithm%20-%20Multi-Paxos%20-%20in%20Java%20gRPC&amp;url=ihelio.today%2fposts%2f2023%2fthe-elegant-consensus-algorithm---multi-paxos---in-java-grpc%2f&amp;hashtags=DistributedSystem%2cAlgorithms%2cgRPC"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share The elegant consensus algorithm - Multi-Paxos - in Java gRPC on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=ihelio.today%2fposts%2f2023%2fthe-elegant-consensus-algorithm---multi-paxos---in-java-grpc%2f&amp;title=The%20elegant%20consensus%20algorithm%20-%20Multi-Paxos%20-%20in%20Java%20gRPC&amp;summary=The%20elegant%20consensus%20algorithm%20-%20Multi-Paxos%20-%20in%20Java%20gRPC&amp;source=ihelio.today%2fposts%2f2023%2fthe-elegant-consensus-algorithm---multi-paxos---in-java-grpc%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share The elegant consensus algorithm - Multi-Paxos - in Java gRPC on reddit" href="https://reddit.com/submit?url=ihelio.today%2fposts%2f2023%2fthe-elegant-consensus-algorithm---multi-paxos---in-java-grpc%2f&title=The%20elegant%20consensus%20algorithm%20-%20Multi-Paxos%20-%20in%20Java%20gRPC"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share The elegant consensus algorithm - Multi-Paxos - in Java gRPC on facebook" href="https://facebook.com/sharer/sharer.php?u=ihelio.today%2fposts%2f2023%2fthe-elegant-consensus-algorithm---multi-paxos---in-java-grpc%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share The elegant consensus algorithm - Multi-Paxos - in Java gRPC on whatsapp" href="https://api.whatsapp.com/send?text=The%20elegant%20consensus%20algorithm%20-%20Multi-Paxos%20-%20in%20Java%20gRPC%20-%20ihelio.today%2fposts%2f2023%2fthe-elegant-consensus-algorithm---multi-paxos---in-java-grpc%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share The elegant consensus algorithm - Multi-Paxos - in Java gRPC on telegram" href="https://telegram.me/share/url?text=The%20elegant%20consensus%20algorithm%20-%20Multi-Paxos%20-%20in%20Java%20gRPC&amp;url=ihelio.today%2fposts%2f2023%2fthe-elegant-consensus-algorithm---multi-paxos---in-java-grpc%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share The elegant consensus algorithm - Multi-Paxos - in Java gRPC on ycombinator" href="https://news.ycombinator.com/submitlink?t=The%20elegant%20consensus%20algorithm%20-%20Multi-Paxos%20-%20in%20Java%20gRPC&u=ihelio.today%2fposts%2f2023%2fthe-elegant-consensus-algorithm---multi-paxos---in-java-grpc%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//ihelio-today.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></article></main><footer class=footer><span>&copy; 2025 <a href=ihelio.today/>iHelio</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>